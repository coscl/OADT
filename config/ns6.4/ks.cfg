# Kickstart file automatically generated by anaconda.

#version=DEVEL
nobody --enable
install
url --url="ftp://192.168.1.1/pub"
#lang en_US.UTF-8
lang zh_CN
keyboard us
#network --onboot yes  
$SNIPPET('network_config')
rootpw  --iscrypted $6$ATHwHDpTWYAMB/nI$g5c.jpNNtIpjqJb3H39iadaEg7bdlf/xLgcSMs5JhkaKxChTK.Q20fnco8LJh.eNvjLlJLod0paVG1F8BZSnP0
firewall --disabled
authconfig --enableshadow --passalgo=sha512
selinux --disabled
timezone Asia/Shanghai
bootloader --location=mbr --driveorder=vda --append="crashkernel=auto rhgb quiet"
# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work
#clearpart --all --drives=vda


#part /boot --fstype=ext4 --size=500
#part swap --grow --maxsize=2368 --size=1184
#part / --fstype=ext4 --grow --maxsize=51200 --size=1024
#clearpart --all --initlabel                                   
#part /boot --fstype="ext4" --size=100                        
#part swap --fstype="swap" --size=2048                       
#part / --fstype="ext4" --grow --size=1

clearpart --none --drives=sda
part /boot --fstype="ext4" --ondisk=sda --size=100                        
part swap --fstype="swap" --ondisk=sda --size=2048                       
part / --fstype="ext4" --grow --ondisk=sda --size=1


reboot
%packages
@base
@chinese-support
@client-mgmt-tools
@console-internet
@core
@debugging
@basic-desktop
@desktop-platform
@development
@directory-client
@eclipse
@emacs
@ftp-server
@fonts
@general-desktop
@graphical-admin-tools
@hardware-monitoring
@input-methods
@internet-browser
@java-platform
@kde-desktop
@large-systems
@mysql-client
@mysql
@nfs-file-server
@network-file-system-client
@performance
@perl-runtime
@remote-desktop-clients
@server-platform
@server-policy
@virtualization
@x11
mtools
pax
python-dmidecode
oddjob
wodim
squashfs-tools
sgpio
genisoimage
device-mapper-persistent-data
cjkuni-fonts-ghostscript
systemtap-client
sabayon-apply
xguest
tigervnc-server
qt-mysql
qt3-ODBC
qt-odbc
qt-postgresql
qt3-PostgreSQL
qt3-MySQL
systemtap-sdt-devel
dejagnu
ElectricFence
ant
libstdc++-docs
gcc-gnat
expect
mod_dav_svn
perltidy
cmake
imake
babel
ksc
kdewebdev
rpmdevtools
compat-gcc-34
systemtap-server
cvs-inetd
gcc-java
compat-gcc-34-g77
jpackage-utils
bzr
mercurial
chrpath
gcc-objc
rpmlint
gcc-objc++
compat-gcc-34-c++
python-docs
nasm
samba-winbind
certmonger
pam_krb5
krb5-workstation
eclipse-mylyn-cdt
eclipse-mylyn-pde
eclipse-mylyn-wikitext
eclipse-mylyn-trac
eclipse-subclipse-graph
eclipse-mylyn-webtasks
emacs-nox
ctags-etags
emacs-gnuplot
emacs-auctex
xferstats
cjkuni-fonts-ghostscript
bitmap-fixed-fonts
bitmap-lucida-typewriter-fonts
krb5-auth-dialog
gnome-pilot-conduits
gconf-editor
byzanz
alacarte
seahorse-plugins
rhythmbox-upnp
gnome-games
gedit-plugins
gnome-pilot
totem-upnp
dvgrab
vim-X11
sabayon
system-config-lvm
audit-viewer
setroubleshoot
firstaidkit-gui
system-config-kickstart
wireshark-gnome
policycoreutils-gui
kdebase-workspace-akonadi
kdebase-workspace-python-applet
libdbi-dbd-mysql
mysql-connector-java
perl-DBD-MySQL
mysql-test
mysql-bench
perl-DBD-SQLite
spice-xpi
tsclient
rdesktop
vinagre
tigervnc
spice-client
qemu-kvm-tools
qemu-guest-agent
telnet
telnet-server
%end

%pre
/usr/sbin/parted -s /dev/sda mklabel msdos
$SNIPPET('pre_install_network_config')

%post

echo "(@-@) (@_@)" >> /etc/hosts
echo "myip myhostname" >> /etc/hosts


mkdir -p /opt/openstack

touch /opt/openstack/start.sh

echo "
yum install -y puppet facter PyYAML
sed -i \"s/disable.*/disable  = no /g\" /etc/xinetd.d/telnet
service xinetd start
chkconfig xinetd on
echo \"listen=true\" >> /etc/puppet/puppet.conf
echo \"runinterval = 6000000000000000\" >> /etc/puppet/puppet.conf
echo \"PUPPET_SERVER=(@_@)\" >> /etc/sysconfig/puppet
touch /etc/puppet/namespaceauth.conf
echo \"[puppetrunner]\" > /etc/puppet/namespaceauth.conf
echo \"allow *\" >> /etc/puppet/namespaceauth.conf
sed -i '/path \/$/d' /etc/puppet/auth.conf
sed -i '/auth any/d' /etc/puppet/auth.conf
echo \"
path /run
method save
allow *
path /
auth any
\" >> /etc/puppet/auth.conf
/etc/init.d/puppet stop
puppetd --server=(@_@)
chkconfig puppet on
ntpdate (@-@)
echo \"ntpdata done\" >> /tmp/tmp.txt
telnet (@-@) 3336&
sleep 2
echo \"myhostname:installed\" | nc (@-@) 6666
echo \"myhostname has installed\" >> /tmp/tmp.txt
" > /opt/openstack/start.sh

echo "sh /opt/openstack/start.sh" >> /etc/rc.local
